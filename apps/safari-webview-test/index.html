<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <!-- Theme color metas will be updated by script to match CSS variables -->
  <meta name="theme-color" id="meta-theme-color" content="#ffffff" />
  <meta name="theme-color" id="meta-theme-color-light" media="(prefers-color-scheme: light)" content="#ffffff" />
  <meta name="theme-color" id="meta-theme-color-dark" media="(prefers-color-scheme: dark)" content="#000000" />

  <title>Safari WebView Theme Test</title>
  <link rel="stylesheet" href="../../shared/ui.css">
  <style>
    :root, html, body { height: 100%; }
    html { background-color: var(--bg); }
    body{
      margin:0;
      min-height:100%;
      -webkit-font-smoothing:antialiased;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui, sans-serif;
    }
  </style>
</head>
<body class="stacked-page">
  <div class="glass-card" id="info">
    <div>Safari WebView Theme Test</div>
    <div class="mt">bg: <span id="bgval">--</span> <span id="bgsw" class="swatch"></span></div>
    <div class="mt">text: <span id="textval">--</span> <span id="textsw" class="swatch"></span></div>
  </div>

  <div class="glass-card mt" id="examples" style="padding:18px;">
    <div class="display">Display example</div>
    <div class="heading-1 mt">Heading 1</div>
    <div class="heading-2 mt">Heading 2</div>
    <div class="heading-3 mt">Heading 3</div>
    <div class="heading-4 mt">Heading 4</div>
    <div class="body mt">This is body text demonstrating the style. It supports wrapping and multiple lines for longer content.</div>
    <div class="body-sm mt">Smaller body text for less prominent content.</div>
    <div class="lead mt">Lead text — a muted intro or summary.</div>
    <div class="caption mt">Caption / metadata text</div>
    <div class="eyebrow mt">Eyebrow label</div>
    <div class="mt"><span class="text-muted">Muted text</span> • <span class="caps">ALL CAPS</span></div>
    <div class="mt" style="max-width:280px;">
      <div class="truncate">Truncated example: This is a very long single-line string that will be truncated with an ellipsis when it overflows the container width.</div>
    </div>
  </div>

  <script>
    function updateThemeMetaAndColors(){
      const s = getComputedStyle(document.documentElement);
      const bg = s.getPropertyValue('--bg').trim() || '#ffffff';
      const text = s.getPropertyValue('--text').trim() || '#000000';

      // Update page colors to ensure seamless background
      document.documentElement.style.backgroundColor = bg;
      document.body.style.backgroundColor = bg;
      document.body.style.color = text;

      // Update debug values
      const bgval = document.getElementById('bgval');
      const textval = document.getElementById('textval');
      const bgsw = document.getElementById('bgsw');
      const textsw = document.getElementById('textsw');
      if(bgval) bgval.textContent = bg;
      if(textval) textval.textContent = text;
      if(bgsw) bgsw.style.background = bg;
      if(textsw) textsw.style.background = text;

      // Update theme-color meta tags so Safari/Android pick up toolbar color
      const m = document.querySelector('meta[name="theme-color"]#meta-theme-color');
      const ml = document.querySelector('meta[name="theme-color"]#meta-theme-color-light');
      const md = document.querySelector('meta[name="theme-color"]#meta-theme-color-dark');
      if(m) m.setAttribute('content', bg);
      if(ml) ml.setAttribute('content', bg);
      if(md) md.setAttribute('content', bg);
      // For good measure set msapplication tile color
      const mt = document.querySelector('meta[name="msapplication-TileColor"]');
      if(mt) mt.setAttribute('content', bg);
    }

    // Initial run
    updateThemeMetaAndColors();

    // React to changes in prefers-color-scheme
    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    try{ mq.addEventListener('change', updateThemeMetaAndColors); }catch(e){ mq.addListener(updateThemeMetaAndColors); }

    // Also watch for changes to CSS variables (e.g., if app toggles `data-theme`)
    const observer = new MutationObserver(updateThemeMetaAndColors);
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });
  </script>
</body>
</html>
