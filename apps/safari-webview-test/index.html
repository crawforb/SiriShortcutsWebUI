<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <!-- Theme color metas will be updated by script to match CSS variables -->
  <meta name="theme-color" id="meta-theme-color" content="#ffffff" />
  <meta name="theme-color" id="meta-theme-color-light" media="(prefers-color-scheme: light)" content="#ffffff" />
  <meta name="theme-color" id="meta-theme-color-dark" media="(prefers-color-scheme: dark)" content="#000000" />

  <title>Safari WebView Theme Test</title>
  <link rel="stylesheet" href="../../shared/ui.css">
  <style>
    :root, html, body { height: 100%; }
    html { background-color: var(--bg0); }
    body{
      margin:0;
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      -webkit-font-smoothing:antialiased;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      background: var(--app-bg);
      background-color: var(--bg0);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui, sans-serif;
    }
    .info{
      background: transparent;
      border-radius: 12px;
      padding: 12px 14px;
      color: var(--text);
      border: 1px solid var(--stroke);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      font-size:13px;
      text-align:center;
    }
    .swatch{ display:inline-block; width:14px; height:14px; border-radius:4px; margin-left:8px; vertical-align:middle; border:1px solid rgba(0,0,0,.08); }
  </style>
</head>
<body>
  <div class="info" id="info">
    <div>Safari WebView Theme Test</div>
    <div style="margin-top:8px;">bg: <span id="bgval">--</span> <span id="bgsw" class="swatch"></span></div>
    <div style="margin-top:6px;">text: <span id="textval">--</span> <span id="textsw" class="swatch"></span></div>
  </div>

  <script>
    function updateThemeMetaAndColors(){
      const s = getComputedStyle(document.documentElement);
      const bg = s.getPropertyValue('--bg0').trim() || '#ffffff';
      const text = s.getPropertyValue('--text').trim() || '#000000';

      // Update page colors to ensure seamless background
      document.documentElement.style.backgroundColor = bg;
      document.body.style.backgroundColor = bg;
      document.body.style.color = text;

      // Update debug values
      const bgval = document.getElementById('bgval');
      const textval = document.getElementById('textval');
      const bgsw = document.getElementById('bgsw');
      const textsw = document.getElementById('textsw');
      if(bgval) bgval.textContent = bg;
      if(textval) textval.textContent = text;
      if(bgsw) bgsw.style.background = bg;
      if(textsw) textsw.style.background = text;

      // Update theme-color meta tags so Safari/Android pick up toolbar color
      const m = document.querySelector('meta[name="theme-color"]#meta-theme-color');
      const ml = document.querySelector('meta[name="theme-color"]#meta-theme-color-light');
      const md = document.querySelector('meta[name="theme-color"]#meta-theme-color-dark');
      if(m) m.setAttribute('content', bg);
      if(ml) ml.setAttribute('content', bg);
      if(md) md.setAttribute('content', bg);
      // For good measure set msapplication tile color
      const mt = document.querySelector('meta[name="msapplication-TileColor"]');
      if(mt) mt.setAttribute('content', bg);
    }

    // Initial run
    updateThemeMetaAndColors();

    // React to changes in prefers-color-scheme
    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    try{ mq.addEventListener('change', updateThemeMetaAndColors); }catch(e){ mq.addListener(updateThemeMetaAndColors); }

    // Also watch for changes to CSS variables (e.g., if app toggles `data-theme`)
    const observer = new MutationObserver(updateThemeMetaAndColors);
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });
  </script>
</body>
</html>
